<div *ngIf="this.showServiserTable" class="div-table">
  <input [(ngModel)]="this.searchServiser" placeholder="Pretrazi serviser ..." type="text"/>
  <button (click)="dodajNovi()" class="dodaj">+ Dodaj Serviser</button>
  <table>
    <thead>
    <tr>
      <th>Id</th>
      <th>Ime</th>
      <th>Prezime</th>
      <th>Username</th>
      <th>Email</th>
      <th>Grad ID</th>
      <th>Spol ID</th>
      <th>Is Serviser</th>
      <th>Akcije</th>
    </tr>
    </thead>

    <tbody *ngFor="let x of filtrirajServiser()">
    <tr>
      <td>{{ x.id }}</td>
      <td>{{ x.ime }}</td>
      <td>{{ x.prezime }}</td>
      <td>{{ x.username }}</td>
      <td>{{ x.email }}</td>
      <td>{{ x.gradID }}</td>
      <td>{{ x.spolID }}</td>
      <td>{{ x.isServiser }}</td>
      <td>
        <button (click)="editServiser(x)">Edit</button>
        <button (click)="brisiServiser(x.id)" class="brisiServiser"> Brisi</button>
      </td>
    </tr>
    </tbody>
  </table>
  <div class="nav">
    <button (click)="goToPrev(currentPage)" class="button-Previous">
      <<
    </button>

    <button (click)="goToPage(p)" *ngFor="let p of pageNumbersArray()" class="broj-page">
      {{ p }}
    </button>

    <button (click)="goToNext(currentPage)" class="button-next"> >></button>
  </div>
</div>


<form #addForm='ngForm' *ngIf="showServiserForm" class="serviserForm">
  <h1>{{ formTitle }}</h1>
  <div class="form-group">
    <label for="ime">Ime:</label>
    <input #ime_polje="ngModel" [(ngModel)]="this.noviServiser!.ime" class="form-control" id="ime" minlength="3"
           name="ime" pattern='[A-Za-z\sčćžđ]+'
           required type="text"/>
  </div>

  <div *ngIf="
      (ime_polje.invalid && (ime_polje.touched || ime_polje.dirty)) ||
      this.jelPopunjeno
    " class="greska-div">
    <span *ngIf="ime_polje.errors?.['required']">Polje je obavezno</span>
    <span *ngIf="ime_polje.errors?.['pattern']">Polje mora biti karakteri</span>
    <span *ngIf="ime_polje.errors?.['minlength']">Minimum 3 karaktera</span>
  </div>

  <div class="form-group">
    <label for="prezime">Prezime:</label>
    <input #prezime_polje="ngModel" [(ngModel)]="this.noviServiser!.prezime" class="form-control" id="prezime"
           name="prezime" pattern='[A-Za-z\sčćžđ]+'
           required type="text"/>
  </div>

  <div *ngIf="
      (prezime_polje.invalid && (prezime_polje.touched || prezime_polje.dirty)) ||
      this.jelPopunjeno
    " class="greska-div">
    <span *ngIf="prezime_polje.errors?.['required']">Polje je obavezno</span>
    <span *ngIf="prezime_polje.errors?.['pattern']">Polje mora biti karakteri</span>
    <span *ngIf="prezime_polje.errors?.['minlength']">Minimum 3 karaktera</span>
  </div>

  <div class="form-group">
    <label for="username">Username:</label>
    <input #username_polje="ngModel" [(ngModel)]="this.noviServiser!.username" class="form-control" id="username"
           minlength="5" name="username" pattern="[A-Za-z\s]+"
           required type="text"/>
  </div>

  <div *ngIf="
      (username_polje.invalid &&
        (username_polje.touched || username_polje.dirty)) ||
      this.jelPopunjeno
    " class="greska-div">
    <span *ngIf="username_polje.errors?.['required']">Polje je obavezno</span>
    <span *ngIf="username_polje.errors?.['pattern']">Polje mora biti karakteri</span>
    <span *ngIf="username_polje.errors?.['minlength']">Minimum 5 karaktera</span>
  </div>

  <div class="form-group">
    <label for="email">Email:</label>
    <input #email_polje="ngModel" [(ngModel)]="this.noviServiser!.email" class="form-control" id="email" name="email"
           pattern="^([a-zA-Z0-9_\-\.]+)@([a-zA-Z\-]+\.)+[a-zA-Z]{2,}$" required
           type="email"/>
  </div>
  
  <div *ngIf="
      (email_polje.invalid && (email_polje.touched || email_polje.dirty)) ||
      this.jelPopunjeno
    " class="greska-div">
    <span *ngIf="email_polje.errors?.['required']">Polje je obavezno</span>
    <span *ngIf="email_polje.errors?.['pattern']">Email adresa nije validna</span>
  </div>


  <div class="form-group">
    <label for="LozinkaServiser">Lozinka:</label>
    <input #lozinka_polje="ngModel" [(ngModel)]="this.noviServiser!.lozinka" class="form-control" id="LozinkaServiser"
           name="lozinka"
           pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$" required
           type="password"/>
  </div>

  <div *ngIf="
      (lozinka_polje.invalid && (lozinka_polje.touched || lozinka_polje.dirty)) ||
      this.jelPopunjeno
    " class="greska-div">
    <span *ngIf="lozinka_polje.errors?.['required']">Polje je obavezno</span>
    <span *ngIf="lozinka_polje.errors?.['pattern']">Lozinka mora biti 8 karaktera</span>
  </div>


  <div class="form-group">
    <label for="GradServiser">Grad</label>
    <select [(ngModel)]="this.noviServiser!.gradID" class="select-grad" id="GradServiser" name="GradServiser">
      <option *ngFor="let x of this.gradPodaci" [value]="x.id">
        {{ x.naziv }}
      </option>
    </select>
  </div>

  <div class="form-group">
    <label for="serviser">Serviser:</label>
    <input [(ngModel)]="this.noviServiser!.isServiser" class="checkbox" id="serviser" name="serviser" type="checkbox"/>
  </div>

  <div>

    <label for="input-pic2">Nova slika</label>
    <input (change)="onFileSelected($event);" accept="image/*" id="input-pic2" type='file'/>

    <img class="oldPic" height="200" src="{{ConfigFile.adresa_servera}}/Serviser/GetImg?username=0" width="200"/>
    <img class="newPic" src="{{ this.novaSlika }}"/>

  </div>

  <div class="div-button">
    <button (click)="closeEdit()" class="btn-zatvori" type="submit">
      Zatvori
    </button>
    <button (click)="dodajServiser(addForm)" class="btn-save" type="submit">
      Dodaj
    </button>
  </div>

</form>


<!-- form edit for Serviser  -->
<form #editForm='ngForm' *ngIf="showServiserEdit" class="serviserForm">
  <h1>{{ formTitle }}</h1>
  <div class="form-group">
    <label for="imeServiser">Ime:</label>
    <input #ime_polje="ngModel" [(ngModel)]="this.odabraniServiser!.ime" class="form-control" id="imeServiser"
           minlength="3" name="ime" pattern='[A-Za-z\sčćžđ]+'
           required type="text"/>
  </div>


  <div *ngIf="
      (ime_polje.invalid && (ime_polje.touched || ime_polje.dirty)) ||
      this.jelPopunjeno
    " class="greska-div">
    <span *ngIf="ime_polje.errors?.['required']">Polje je obavezno</span>
    <span *ngIf="ime_polje.errors?.['pattern']">Polje mora biti karakteri</span>
    <span *ngIf="ime_polje.errors?.['minlength']">Minimum 3 karaktera</span>
  </div>

  <div class="form-group">
    <label for="prezimeServiser">Prezime:</label>
    <input #prezime_polje="ngModel" [(ngModel)]="this.odabraniServiser!.prezime" class="form-control"
           id="prezimeServiser" name="prezime" pattern='[A-Za-z\sčćžđ]+'
           required type="text"/>
  </div>

  <div *ngIf="
      (prezime_polje.invalid && (prezime_polje.touched || prezime_polje.dirty)) ||
      this.jelPopunjeno
    " class="greska-div">
    <span *ngIf="prezime_polje.errors?.['required']">Polje je obavezno</span>
    <span *ngIf="prezime_polje.errors?.['pattern']">Polje mora biti karakteri</span>
    <span *ngIf="prezime_polje.errors?.['minlength']">Minimum 3 karaktera</span>
  </div>

  <div class="form-group">
    <label for="usernameServiser">Username:</label>
    <input #username_polje="ngModel" [(ngModel)]="this.odabraniServiser!.username" class="form-control"
           id="usernameServiser" minlength="5" name="username"
           pattern="[A-Za-z\s]+" required type="text"/>
  </div>

  <div *ngIf="
      (username_polje.invalid &&
        (username_polje.touched || username_polje.dirty)) ||
      this.jelPopunjeno
    " class="greska-div">
    <span *ngIf="username_polje.errors?.['required']">Polje je obavezno</span>
    <span *ngIf="username_polje.errors?.['pattern']">Polje mora biti karakteri</span>
    <span *ngIf="username_polje.errors?.['minlength']">Minimum 5 karaktera</span>
  </div>

  <div class="form-group">
    <label for="emailServiser">Email:</label>
    <input #email_polje="ngModel" [(ngModel)]="this.odabraniServiser!.email" class="form-control" id="emailServiser"
           name="email"
           pattern="^([a-zA-Z0-9_\-\.]+)@([a-zA-Z\-]+\.)+[a-zA-Z]{2,}$" required
           type="email"/>
  </div>

  <div *ngIf="
      (email_polje.invalid && (email_polje.touched || email_polje.dirty)) ||
      this.jelPopunjeno
    " class="greska-div">
    <span *ngIf="email_polje.errors?.['required']">Polje je obavezno</span>
    <span *ngIf="email_polje.errors?.['pattern']">Email adresa nije validna</span>
  </div>


  <div class="form-group">
    <label for="LozinkaServiser">Lozinka:</label>
    <input #lozinka_polje="ngModel" [(ngModel)]="this.opcionalnaLozinka" class="form-control" id="LozinkaServiser2"
           name="lozinka" pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$"
           type="password"/>
  </div>

  <div *ngIf="
      (lozinka_polje.invalid && (lozinka_polje.touched || lozinka_polje.dirty)) ||
      this.jelPopunjeno
    " class="greska-div">
    <span *ngIf="lozinka_polje.errors?.['pattern']">Lozinka mora biti 8 karaktera</span>
  </div>


  <div class="form-group">
    <label for="Grad">Grad</label>
    <select [(ngModel)]="this.odabraniServiser!.gradID" class="select-grad" id="Grad" name="Grad">
      <option *ngFor="let x of this.gradPodaci" [value]="x.id">
        {{ x.naziv }}
      </option>
    </select>
  </div>

  <div class="form-group">
    <label for="isServiser">Serviser:</label>
    <input [(ngModel)]="this.odabraniServiser!.isServiser" class="checkbox" id="isServiser" name="isServiser"
           type="checkbox"/>
  </div>


  <div>

    <label for="input-pic">Nova slika</label>
    <input (change)="onFileSelected($event);" accept="image/*" id="input-pic" type='file'/>

    <img class="oldPic" height="200"
         src="{{ConfigFile.adresa_servera}}/Serviser/GetImg?username={{this.odabraniServiser?.username?.toLocaleLowerCase()}}"
         width="200"/>

    <img class="newPic" src="{{ this.novaSlika }}"/>

  </div>


  <div class="div-button">
    <button (click)="closeEdit()" class="btn-zatvori" type="submit">
      Zatvori
    </button>
    <button (click)="snimiServiser(editForm)" class="btn-save" type="submit">
      Snimi
    </button>
  </div>

</form>


